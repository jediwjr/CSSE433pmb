{% extends "template.html" %}
  <title>Messages</title>
{% block body %}
  {% set chunks = chunklist(returned, 5) %}
  {% for chunk in chunks %}
    <div class='row'>
      {% for msg in chunk %}
      <div class='post_message'>
            {% if session.username == msg[4] and not(session.username == '') %}
            <form action="" method=post>
              <input type="hidden" name="msg_id" value={{ msg[0] }}>
              <input type="submit" value="Like">
            </form>
           <!--  <form action="{{ url_for('edit_message') }}" method=post>
              <input type="hidden" name="msg_id" value={{ msg[0] }}>
              <input type="submit" value=Edit>
            </form> -->
           <input type="button" value="Edit" onclick="enable_edit('{{ msg[0] }}')" />
            <form action="{{ url_for('delete_message') }}" method=post>
              <input type="hidden" name="msg_id" value={{ msg[0] }}>
              <input type="submit" Value=&#10006>
            </form>
            <script type="text/javascript">
              function enable_edit(msg_id) {
                var elem = document.getElementById(msg_id);
                elem.contentEditable = 'true';
                var button = document.createElement("input");
                button.type = "button";
                button.value = "Submit";
                button.onclick = function() {
                  elem.contentEditable = 'false';
                  this.remove();
                  var request = new XMLHttpRequest();
                  reqtext = "http://localhost:5000/edit_message?msgid="+msg_id+"&newtext="+elem.innerHTML;
                  request.open("GET", reqtext, true);
                  request.send();
                }
                document.getElementById("b-"+msg_id).appendChild(button);
              }
            </script>
            {% endif %}
            </br></br></br>
          <!-- The text should be index 3, user index 4 -->
          <div class='post_message_text' id="{{ msg[0] }}">
            {{ msg[3] }}
          </div>

          <div class='submit_button' id='b-{{ msg[0] }}'></div>
          {% if msg[4] != '' %}
          <div class="post_message_author">
            Posted by {{ msg[4] }} </br>
          </div>
          {% endif %}
      </div>
      {% endfor %}
    </div>
   {% endfor %}
{% endblock %}
